<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Calendar (Formatted)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* --- CSS 스타일 --- */
        
        /* 1. 캘린더 레이아웃 */
        .calendar-header { 
            @apply flex items-center justify-between mb-4 p-2; 
        }
        .month-title { 
            @apply text-lg font-bold text-center; 
        }
        .nav-btn { 
            @apply p-2 text-xl font-bold text-gray-700 disabled:opacity-30 hover:bg-gray-100 rounded-full transition-colors; 
        }
        
        /* 2. 그리드 & 테이블 */
        .month-grid { @apply mb-6; }
        .month-grid h3 { @apply mb-4 text-base font-semibold text-center; }
        table { @apply w-full text-center border-collapse; }
        th { @apply pb-2 font-normal text-gray-500 text-sm; }
        th.is-sun { @apply text-red-500; }

        /* 3. 날짜 버튼 */
        .day-btn {
            @apply w-9 h-9 flex items-center justify-center rounded-full mx-auto relative transition-all duration-200 text-sm;
            flex-direction: column; 
            line-height: 1; 
            padding-top: 4px; 
            cursor: pointer;
        }
        .day-btn:not(:disabled):hover { @apply bg-gray-100; }
        .day-btn:focus-visible { @apply ring-2 ring-offset-2 ring-blue-500 outline-none z-10; }

        /* 4. 상태별 스타일 */
        .day-btn.is-sun { @apply text-red-500; }
        .day-btn.is-today { @apply border border-gray-400 font-bold; }
        
        /* 비활성화 */
        .day-btn:disabled, 
        td.is-disabled .day-btn { 
            @apply text-gray-300 cursor-not-allowed line-through opacity-50; 
            pointer-events: none; 
        }
        
        /* 선택된 날짜 */
        td.is-start-date .day-btn,
        td.is-end-date .day-btn,
        td.is-single-date .day-btn { 
            @apply bg-blue-600 text-white font-bold shadow-md;
            opacity: 1 !important;
        }

        /* 범위 배경 */
        td.is-in-range { @apply bg-blue-50; }
        td.is-range-start { @apply rounded-l-2xl; }
        td.is-range-end { @apply rounded-r-2xl; }

        /* 월 경계 마커 */
        td.range-end-marker { background: linear-gradient(to right, #eff6ff 50%, transparent 50%); }
        td.range-start-marker { background: linear-gradient(to left, #eff6ff 50%, transparent 50%); }

        /* 오늘 레이블 */
        .today-label { position: absolute; bottom: 2px; font-size: 10px; font-weight: 500; color: inherit; }
        td.is-start-date .today-label, td.is-end-date .today-label, td.is-single-date .today-label { color: white; }

        /* 애니메이션 */
        .calendar-slider { transition: transform 0.3s ease-in-out; }
        .month-container { min-width: 100%; }
    </style>
</head>
<body class="p-10 bg-gray-50">

    <div class="max-w-lg mx-auto bg-white p-6 rounded-xl shadow-lg">
        <h2 class="text-xl font-bold mb-6 text-gray-800">Formatted Code Version</h2>
        
        <div class="p-4 border border-gray-200 rounded-lg bg-gray-50 mb-6">
            <div class="flex space-x-4">
                <div class="w-1/2">
                    <label class="block text-xs font-bold text-gray-500 mb-1">시작일</label>
                    <input id="start-date-input" class="w-full border p-2 rounded text-center font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none" value="2025.11.29" />
                </div>
                <div class="w-1/2">
                    <label class="block text-xs font-bold text-gray-500 mb-1">종료일</label>
                    <input id="end-date-input" class="w-full border p-2 rounded text-center font-medium text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none" value="2025-12-05" /> 
                </div>
            </div>
        </div>

        <div id="calendar-root" aria-live="polite"></div>
    </div>

<script>
    // ============================================
    //  ⬇️ CalendarLib Core (Formatted) ⬇️
    // ============================================

    function CalendarLib(element, options) {
        if (!element) {
            console.error("CalendarLib: Error - Element not found");
            return;
        }
        
        this.element = element;
        options = options || {};
        
        var defaultDayNames = ['일', '월', '화', '수', '목', '금', '토'];
        var defaultMonthNames = ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'];

        this.options = {
            numberOfMonths: options.numberOfMonths, 
            selectionMode: options.selectionMode || 'RANGE',
            startDateSelector: options.startDateSelector || null, 
            endDateSelector: options.endDateSelector || null, 
            
            // Format & Labels
            format: options.format || 'YYYY.MM.DD(ddd)', 
            defaultStartLabel: options.defaultStartLabel || '가는날', 
            defaultEndLabel: options.defaultEndLabel || '오는날',
            dayNames: options.dayNames || defaultDayNames,
            monthNames: options.monthNames || defaultMonthNames, 
            monthHeaderFormat: options.monthHeaderFormat || 'YYYY년 M월',

            // Features
            swipeNavigation: options.swipeNavigation || false, 
            rangeClass: options.rangeClass || null,
            
            // Restrictions
            disable: options.disable || [], 
            enable: options.enable || [],
            selectableDays: options.selectableDays || null, 
            minDate: options.minDate !== undefined ? options.minDate : 'today', 
            maxDate: options.maxDate || null,
            
            // Initial Values
            startDate: options.startDate || null, 
            endDate: options.endDate || null,

            // Callbacks
            onSelect: options.onSelect || null, 
            onInvalid: options.onInvalid || null, 
            onMonthChange: options.onMonthChange || null, 
            onRenderCell: options.onRenderCell || null
        };
        
        this.els = {
            startInput: this.options.startDateSelector ? document.querySelector(this.options.startDateSelector) : null,
            endInput: (this.options.selectionMode === 'RANGE' && this.options.endDateSelector) ? document.querySelector(this.options.endDateSelector) : null
        };
        
        this.isSingleMode = (this.options.selectionMode === 'SINGLE');
        this.startDate = null; 
        this.endDate = null;
        this.today = new Date(); 
        this.today.setHours(0, 0, 0, 0);
        this.minLimit = null; 
        this.maxLimit = null;
        
        this.allDayBtns = []; 
        this.cachedMarkerTds = [];
        this.monthData = []; 
        this.currentMonthIndex = 0; 
        this.isEventBound = false;

        this.init();
    }

    /**
     * 초기화 함수
     */
    CalendarLib.prototype.init = function() {
        var initialStartISO = this.options.startDate || null; 
        var initialEndISO = (!this.isSingleMode && this.options.endDate) ? this.options.endDate : null;
        
        // Input에서 값 읽어오기
        if (!initialStartISO && this.els.startInput) { 
            initialStartISO = this._parseDisplayDate(this.els.startInput.value); 
        }
        if (!initialEndISO && this.els.endInput) { 
            initialEndISO = this._parseDisplayDate(this.els.endInput.value); 
        }

        // Min/Max Limit 설정
        if (this.options.minDate === 'today') { 
            this.minLimit = new Date(this.today.getTime()); 
        } else if (this.options.minDate) { 
            this.minLimit = this._parseDate(this._parseDisplayDate(this.options.minDate)); 
        } else { 
            this.minLimit = null; 
        }

        if (typeof this.options.selectableDays === 'number' && this.options.selectableDays > 0) {
            var baseDate = this.minLimit ? new Date(this.minLimit.getTime()) : new Date(this.today.getTime());
            this.maxLimit = new Date(baseDate.getTime());
            this.maxLimit.setDate(this.maxLimit.getDate() + this.options.selectableDays - 1);
        } else if (this.options.maxDate) {
            this.maxLimit = this._parseDate(this._parseDisplayDate(this.options.maxDate));
        }

        if (this.minLimit) this.minLimit.setHours(0,0,0,0);
        if (this.maxLimit) this.maxLimit.setHours(0,0,0,0);

        // 렌더링 기준일 및 기간 계산
        var startObj = initialStartISO ? this._parseDate(initialStartISO) : null;
        var renderBaseDate = startObj ? new Date(startObj.getTime()) : (this.minLimit ? new Date(this.minLimit.getTime()) : new Date(this.today.getTime()));
        
        if (this.minLimit && renderBaseDate < this.minLimit) {
            renderBaseDate = new Date(this.minLimit.getTime());
        }

        var startYear = renderBaseDate.getFullYear();
        var startMonth = renderBaseDate.getMonth() + 1;

        // numberOfMonths 자동 계산
        if (!this.options.numberOfMonths) {
            var neededMonths = 2;
            if (initialEndISO) {
                var endDateObj = this._parseDate(initialEndISO);
                if (endDateObj) {
                    var diff = (endDateObj.getFullYear() * 12 + endDateObj.getMonth()) - (startYear * 12 + (startMonth - 1)) + 1;
                    neededMonths = Math.max(neededMonths, diff);
                }
            }
            this.options.numberOfMonths = neededMonths;
        }

        // UI 생성
        this.element.innerHTML = '';
        if (this.options.swipeNavigation) { 
            this._buildSwipeStructure(startYear, startMonth); 
            this.currentMonthIndex = 0; 
        } else { 
            this._buildScrollStructure(startYear, startMonth); 
        }

        // DOM 캐싱
        this.allDayBtns = this.element.querySelectorAll('.day-btn');
        this.cachedMarkerTds = this.element.querySelectorAll('[data-marker-type]');

        // 이벤트 바인딩 (최초 1회)
        if (!this.isEventBound) {
            this.element.addEventListener('click', this._handleDayClick.bind(this));
            this.isEventBound = true;
        }
        
        // 초기 선택값 세팅
        this.setRange(initialStartISO, initialEndISO);
        
        // 렌더링 후 콜백
        this._triggerRenderCell();
    };

    /**
     * onRenderCell 콜백 실행기
     */
    CalendarLib.prototype._triggerRenderCell = function() {
        if (typeof this.options.onRenderCell === 'function') {
            for (var i = 0; i < this.allDayBtns.length; i++) {
                var btn = this.allDayBtns[i];
                var d = this._parseDate(btn.dataset.date);
                var cell = btn.parentNode;
                this.options.onRenderCell(d, cell);
            }
        }
    };

    /**
     * 날짜 비활성화 체크
     */
    CalendarLib.prototype._isDateDisabled = function(dateObj, dateStr) {
        if (this.minLimit && dateObj.getTime() < this.minLimit.getTime()) return true;
        if (this.maxLimit && dateObj.getTime() > this.maxLimit.getTime()) return true;
        if (this.options.enable && this.options.enable.length > 0) return this.options.enable.indexOf(dateStr) === -1;
        if (this.options.disable && this.options.disable.length > 0) return this.options.disable.indexOf(dateStr) !== -1;
        return false;
    };

    /**
     * 날짜 선택 (외부 호출 가능)
     */
    CalendarLib.prototype.setRange = function(start, endOrDuration) {
        var endOr = endOrDuration !== undefined ? endOrDuration : null; 
        this.startDate = start || null; 
        this.endDate = null;

        if (this.isSingleMode) {
            // SINGLE 모드
        } else if (this.startDate) {
            // RANGE 모드
            if (typeof endOr === 'string') { 
                this.endDate = endOr; 
            } else if (typeof endOr === 'number') {
                var date = this._parseDate(this.startDate); 
                if (date) { 
                    date.setDate(date.getDate() + endOr); 
                    this.endDate = this._dateToISO(date); 
                }
            }
            // 유효성 검사 (종료일 <= 시작일이면 무효화)
            if (this.endDate) {
                var s = this._parseDate(this.startDate); 
                var e = this._parseDate(this.endDate);
                s.setHours(0,0,0,0); e.setHours(0,0,0,0);
                if (e.getTime() <= s.getTime()) { 
                    this.endDate = null; 
                }
            }
        } 
        this._updateUI();
    };

    /**
     * 날짜 클릭 이벤트 핸들러
     */
    CalendarLib.prototype._handleDayClick = function(e) {
        var target = e.target;
        var btn = target.closest('.day-btn');
        
        if (!btn) return; 
        
        // 비활성 클릭 시 콜백
        if (btn.disabled) {
             if(typeof this.options.onInvalid === 'function') { 
                 this.options.onInvalid(btn.dataset.date); 
             }
             return; 
        }
        
        var clickedDate = btn.dataset.date;
        
        if (this.isSingleMode) {
            this.startDate = clickedDate; 
            this.endDate = null;
        } else {
            if (this.startDate && this.endDate) { 
                this.startDate = clickedDate; 
                this.endDate = null; 
            } else if (this.startDate && !this.endDate) {
                var sDate = this._parseDate(this.startDate);
                var cDate = this._parseDate(clickedDate);
                if (cDate.getTime() <= sDate.getTime()) {
                    this.startDate = clickedDate; 
                    this.endDate = null; 
                } else { 
                    this.endDate = clickedDate; 
                }
            } else { 
                this.startDate = clickedDate; 
            }
        }
        
        this._updateUI();
        
        if(typeof this.options.onSelect === 'function') { 
            this.options.onSelect(this.getValue()); 
        }
    };

    /**
     * UI 업데이트 (DOM 파괴 없이 클래스만 변경)
     */
    CalendarLib.prototype._updateUI = function() {
        var start = this.startDate ? this._parseDate(this.startDate) : null; 
        var end = this.endDate ? this._parseDate(this.endDate) : null; 
        var customClass = this.options.rangeClass;
        
        // 1. 날짜 버튼 업데이트
        for (var i = 0; i < this.allDayBtns.length; i++) {
            var btn = this.allDayBtns[i]; 
            var dayDateStr = btn.dataset.date; 
            if (!dayDateStr) continue;
            
            var dayDate = this._parseDate(dayDateStr); 
            var dayCell = btn.parentNode; 
            
            // 초기화
            btn.setAttribute('aria-selected', 'false'); 
            dayCell.classList.remove('is-in-range', 'is-range-start', 'is-range-end', 'is-start-date', 'is-end-date', 'is-single-date');
            if (customClass) { dayCell.classList.remove(customClass); }

            // 오늘 날짜
            if (dayDate.getTime() === this.today.getTime()) { 
                btn.setAttribute('aria-current', 'date'); 
            }

            if (this.isSingleMode) {
                if (this.startDate === dayDateStr) { 
                    dayCell.classList.add('is-single-date'); 
                    btn.setAttribute('aria-selected', 'true');
                }
            } else {
                // RANGE 모드
                if (start && end) {
                    if (dayDate > start && dayDate < end) { 
                        dayCell.classList.add('is-in-range'); 
                        if (customClass) { dayCell.classList.add(customClass); }
                    }
                }
                if (dayDateStr === this.startDate) { 
                    dayCell.classList.add('is-start-date'); 
                    btn.setAttribute('aria-selected', 'true'); 
                    if (end) { dayCell.classList.add('is-range-start'); } 
                } 
                if (dayDateStr === this.endDate) { 
                    dayCell.classList.add('is-end-date'); 
                    btn.setAttribute('aria-selected', 'true'); 
                    if (start) { dayCell.classList.add('is-range-end'); }
                }
            }
        } 

        // 2. 월 경계 마커 업데이트
        for (var k = 0; k < this.cachedMarkerTds.length; k++) {
            var markerTd = this.cachedMarkerTds[k];
            var type = markerTd.dataset.markerType; 
            var refDate = this._parseDate(markerTd.dataset.refDate);
            
            markerTd.classList.remove('range-start-marker', 'range-end-marker');

            if (start && end) {
                if (type === 'prev') {
                    if (start.getTime() < refDate.getTime() && end.getTime() >= refDate.getTime()) {
                        markerTd.classList.add('range-start-marker');
                    }
                } else if (type === 'next') {
                    if (start.getTime() <= refDate.getTime() && end.getTime() > refDate.getTime()) {
                        markerTd.classList.add('range-end-marker');
                    }
                }
            }
        }
        
        this._updateSelectorDisplays();
        this._dispatchChangeEvent();
    };

    /**
     * Input 값 업데이트 (동기화)
     */
    CalendarLib.prototype._updateSelectorDisplays = function() {
        var fmt = this.options.format; 
        var sLab = this.options.defaultStartLabel; 
        var eLab = this.options.defaultEndLabel;
        
        var updateInput = function(el, dateStr, label) {
            if (!el) return;
            var display = dateStr ? this._formatDate(dateStr, fmt) : label;
            if (el.tagName === 'INPUT') { el.value = display; } 
            else { el.textContent = display; }
        }.bind(this);
        
        if (this.els.startInput) { 
            updateInput(this.els.startInput, this.startDate, (this.isSingleMode ? '날짜 선택' : sLab)); 
        }
        if (this.els.endInput && !this.isSingleMode) { 
            updateInput(this.els.endInput, this.endDate, eLab); 
        }
    };
    
    /**
     * HTML 생성 메서드
     */
    CalendarLib.prototype._generateCalendarHTML = function(year, month) {
        var monthIndex = month - 1; 
        var firstDay = new Date(year, monthIndex, 1);
        var daysInMonth = new Date(year, month, 0).getDate();
        var startDayOfWeek = firstDay.getDay(); 
        
        var monthTitle = this.options.monthHeaderFormat
            .replace('YYYY', year)
            .replace('M', month)
            .replace('MM', (month < 10 ? '0'+month : month));

        var html = '<div class="month-grid">' + 
            '<h3 id="month-'+year+'-'+month+'">' + monthTitle + '</h3>' +
            '<table role="grid" aria-labelledby="month-'+year+'-'+month+'">' +
                '<thead><tr>';
        
        for (var d = 0; d < 7; d++) {
            var thClass = (d === 0) ? 'is-sun' : '';
            html += '<th scope="col" class="' + thClass + '">' + this.options.dayNames[d] + '</th>';
        }
        html += '</tr></thead><tbody>';
            
        var dayCounter = 1; 
        var paddingStarted = false;
        
        // 마커용 날짜
        var firstDayOfCurrentMonth = new Date(year, monthIndex, 1); firstDayOfCurrentMonth.setHours(0,0,0,0);
        var lastDayOfCurrentMonth = new Date(year, monthIndex, daysInMonth); lastDayOfCurrentMonth.setHours(0,0,0,0);
        var firstDayISO = this._dateToISO(firstDayOfCurrentMonth);
        var lastDayISO = this._dateToISO(lastDayOfCurrentMonth);

        for (var i = 0; i < 6; i++) {
            html += '<tr>';
            for (var j = 0; j < 7; j++) {
                var tdClasses = ''; var classes = 'day-btn'; var extraLabel = ''; var ariaLabel = '';
                var markerAttr = '';

                if (i === 0 && j < startDayOfWeek) { 
                    if (j === startDayOfWeek - 1) { markerAttr = 'data-marker-type="prev" data-ref-date="' + firstDayISO + '"'; }
                    html += '<td class="' + tdClasses + '" ' + markerAttr + '><span aria-hidden="true"></span></td>'; continue;
                } else if (dayCounter > daysInMonth) {
                    if (!paddingStarted) { markerAttr = 'data-marker-type="next" data-ref-date="' + lastDayISO + '"'; paddingStarted = true; }
                    html += '<td class="' + tdClasses + '" ' + markerAttr + '><span aria-hidden="true"></span></td>'; dayCounter++; continue;
                } else {
                    var dateObj = new Date(year, monthIndex, dayCounter); dateObj.setHours(0,0,0,0);
                    var fullDateStr = this._dateToISO(dateObj);
                    
                    ariaLabel = year + '년 ' + month + '월 ' + dayCounter + '일';

                    if (j === 0) classes += ' is-sun';
                    if (dateObj.getTime() === this.today.getTime()) { 
                        classes += ' is-today'; 
                        extraLabel = '<span class="today-label" aria-hidden="true">오늘</span>';
                        ariaLabel += ', 오늘';
                    }
                    
                    var isDisabled = this._isDateDisabled(dateObj, fullDateStr);
                    var disabledAttr = isDisabled ? 'disabled aria-disabled="true"' : '';
                    if (isDisabled) { tdClasses += ' is-disabled'; classes += ' is-disabled'; }
                    
                    html += '<td class="' + tdClasses + '"><button type="button" class="' + classes + '" data-date="' + fullDateStr + '" aria-label="' + ariaLabel + '" ' + disabledAttr + '>' + dayCounter + extraLabel + '</button></td>';
                    dayCounter++;
                }
            }
            html += '</tr>';
            if (dayCounter > daysInMonth) break; 
        }
        html += '</tbody></table></div>';
        return html;
    };

    // --- Helper Methods ---
    CalendarLib.prototype.getValue = function() { return { startDate: this.startDate, endDate: this.endDate }; };
    CalendarLib.prototype._dispatchChangeEvent = function() {
        var event; var params = { detail: this.getValue(), bubbles: true, cancelable: true };
        try { event = new CustomEvent('calendar-change', params); } catch (e) { event = document.createEvent('CustomEvent'); event.initCustomEvent('calendar-change', true, true, this.getValue()); }
        this.element.dispatchEvent(event);
    };
    CalendarLib.prototype._parseDisplayDate = function(dateString) { 
        if (!dateString) return null; 
        var cleanDate = dateString.split('(')[0].trim().replace(/[\.\/]/g, '-'); 
        return /^\d{4}-\d{1,2}-\d{1,2}$/.test(cleanDate) ? cleanDate : null; 
    };
    CalendarLib.prototype._formatDate = function(dateString, formatString) {
        if (!dateString || !formatString) return null; var date = this._parseDate(dateString); if (!date) return null;
        var y = date.getFullYear(), m = date.getMonth() + 1, d = date.getDate(), dayIdx = date.getDay();
        var tokens = { YYYY: y, MM: m<10?'0'+m:m, M: m, DD: d<10?'0'+d:d, D: d, ddd: this.options.dayNames[dayIdx] };
        return formatString.replace(/YYYY|MM|M|DD|D|ddd/g, function(x) { return tokens[x] || x; });
    };
    CalendarLib.prototype._parseDate = function(str) { 
        if (!str) return null; var p = str.split('-'); 
        return new Date(p[0], p[1]-1, p[2]); 
    };
    CalendarLib.prototype._dateToISO = function(d) { 
        if(!d) return null; var m = d.getMonth()+1, day = d.getDate(); 
        return d.getFullYear() + '-' + (m<10?'0'+m:m) + '-' + (day<10?'0'+day:day); 
    };
    CalendarLib.prototype._buildSwipeStructure = function(startYear, startMonth) {
        var current = new Date(startYear, startMonth - 1, 1); this.monthData = [];
        for (var i = 0; i < this.options.numberOfMonths; i++) { this.monthData.push({ year: current.getFullYear(), month: current.getMonth() + 1 }); current.setMonth(current.getMonth() + 1); }
        var navHtml = '<div class="calendar-header"><button class="nav-prev nav-btn" aria-label="이전 달">&lt;</button><h3 class="month-title" aria-live="polite"></h3><button class="nav-next nav-btn" aria-label="다음 달">&gt;</button></div>';
        this.element.innerHTML += navHtml;
        var viewport = document.createElement('div'); viewport.className = 'calendar-viewport overflow-hidden relative';
        var slider = document.createElement('div'); slider.className = 'calendar-slider flex';
        for (var i = 0; i < this.monthData.length; i++) {
            var m = this.monthData[i]; var html = this._generateCalendarHTML(m.year, m.month);
            var wrap = document.createElement('div'); wrap.className = 'month-container min-w-full'; 
            var tempDiv = document.createElement('div'); tempDiv.innerHTML = html;
            if(tempDiv.querySelector('h3')) tempDiv.querySelector('h3').remove();
            wrap.innerHTML = tempDiv.innerHTML; slider.appendChild(wrap);
        }
        viewport.appendChild(slider); this.element.appendChild(viewport); this._bindSwipeEvents(); this._updateNavigationTitle();
    };
    CalendarLib.prototype._buildScrollStructure = function(startYear, startMonth) {
        var current = new Date(startYear, startMonth - 1, 1); var container = document.createElement('div'); container.className = 'calendar-scroll-container space-y-4 max-h-[50vh] overflow-y-auto';
        for (var i = 0; i < this.options.numberOfMonths; i++) { container.innerHTML += this._generateCalendarHTML(current.getFullYear(), current.getMonth() + 1); current.setMonth(current.getMonth() + 1); }
        this.element.appendChild(container);
    };
    CalendarLib.prototype._bindSwipeEvents = function() {
        var self = this; var prevBtn = this.element.querySelector('.nav-prev'); var nextBtn = this.element.querySelector('.nav-next');
        prevBtn.addEventListener('click', function() { self._handleNavClick(-1); }); nextBtn.addEventListener('click', function() { self._handleNavClick(1); });
    };
    CalendarLib.prototype._handleNavClick = function(dir) {
        var next = this.currentMonthIndex + dir; if (next >= 0 && next < this.monthData.length) { 
            this.currentMonthIndex = next; this._animateSwipe(); this._updateNavigationTitle(); 
            if(this.options.onMonthChange) this.options.onMonthChange(this.monthData[next].year, this.monthData[next].month);
        }
    };
    CalendarLib.prototype._animateSwipe = function() { this.element.querySelector('.calendar-slider').style.transform = 'translateX(' + (-100 * this.currentMonthIndex) + '%)'; };
    CalendarLib.prototype._updateNavigationTitle = function() {
        var m = this.monthData[this.currentMonthIndex]; 
        // 헤더 포맷 적용
        var title = this.options.monthHeaderFormat.replace('YYYY', m.year).replace('M', m.month).replace('MM', (m.month<10?'0'+m.month:m.month));
        this.element.querySelector('.month-title').textContent = title;
        var p = this.element.querySelector('.nav-prev'), n = this.element.querySelector('.nav-next');
        p.disabled = this.currentMonthIndex===0; n.disabled = this.currentMonthIndex===this.monthData.length-1; p.style.opacity = p.disabled?.5:1; n.style.opacity = n.disabled?.5:1;
    };

    // ============================================
    //  ⬇️ 실행 코드 ⬇️
    // ============================================
    
    var myCalendar;

    document.addEventListener('DOMContentLoaded', function() {
        myCalendar = new CalendarLib(document.getElementById('calendar-root'), {
            selectionMode: 'RANGE', 
            startDateSelector: '#start-date-input', 
            endDateSelector: '#end-date-input',
            format: 'YYYY.MM.DD(ddd)',
            swipeNavigation: false,
            minDate: null, // 과거 날짜 허용

            onSelect: function(val) { console.log('Select:', val); }
        });
    });

</script>
</body>
</html>
